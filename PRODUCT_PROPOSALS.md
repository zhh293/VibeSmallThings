# Flutter åˆ›æ–°äº§å“é¡¹ç›®è§„åˆ’æ–‡æ¡£

> **ðŸ¤– AI åŠ©æ‰‹æç¤º (AI Instructions)**:
> åœ¨æ‰§è¡Œæœ¬é¡¹ç›®å¼€å‘æ—¶ï¼Œè¯·åŠ¡å¿…è°ƒç”¨ **Frontend Design Skills** (å¦‚ UI/UX è®¾è®¡åŽŸåˆ™ã€ç»„ä»¶åŒ–æ€ç»´ã€å“åº”å¼å¸ƒå±€)ã€‚
> ä»£ç å®žçŽ°éœ€éµå¾ª **Clean Architecture**ï¼Œä¼˜å…ˆé€‰æ‹©**ç¨³å®š (Stable)** ä¸” **è½»é‡çº§ (Lightweight)** çš„ç¬¬ä¸‰æ–¹åº“ã€‚
> ç¡®ä¿æ¨¡å—å…·æœ‰é«˜å†…èšä½Žè€¦åˆç‰¹æ€§ï¼Œä»¥ä¾¿äºŽæœªæ¥çš„åŠŸèƒ½æ‰©å±•ã€‚

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†ä¸¤ä¸ªåŸºäºŽ Flutter çš„åˆ›æ–°äº§å“æ¦‚å¿µï¼š**Code-to-Video Generator (ä»£ç æˆç‰‡)** å’Œ **Off-Grid Mesh Messenger (æ— ç½‘å¯¹è®²æœº)**ã€‚

---

## 1. Code-to-Video Generator (ä»£ç æˆç‰‡)

**å®šä½**ï¼šç¨‹åºå‘˜çš„â€œæŠ–éŸ³/TikTokâ€å†…å®¹ç”Ÿäº§ç¥žå™¨ã€‚
**æ ¸å¿ƒä»·å€¼**ï¼šæŠŠæž¯ç‡¥çš„ä»£ç ç‰‡æ®µçž¬é—´å˜æˆæžå…·è§‚èµæ€§çš„â€œé»‘å®¢é£Žæ ¼â€çŸ­è§†é¢‘ã€‚

### 1.1 é¡¹ç›®æ¦‚è§ˆ

| ç»´åº¦ | æè¿° |
| :--- | :--- |
| **æŠ€æœ¯æ ˆ** | Flutter (Impeller æ¸²æŸ“) + FFmpeg Kit (Min-GPL) + Riverpod (çŠ¶æ€ç®¡ç†) |
| **ç›®æ ‡ç”¨æˆ·** | æŠ€æœ¯åšä¸»ã€æ•™è‚²å·¥ä½œè€…ã€æƒ³åœ¨ç¤¾äº¤åª’ä½“åˆ†äº«ä»£ç çš„å¼€å‘è€… |
| **æ ¸å¿ƒæµç¨‹** | è¾“å…¥ä»£ç  -> é€‰æ‹©ä¸»é¢˜/ç‰¹æ•ˆ -> é¢„è§ˆåŠ¨ç”» -> å¯¼å‡º MP4 |

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (High-Quality Architecture)

1.  **é«˜æ€§èƒ½ä»£ç ç¼–è¾‘å™¨ (Editor Core)**
    *   **æŠ€æœ¯é€‰åž‹**ï¼š`code_text_field` (è½»é‡çº§) æˆ– `flutter_code_editor`ã€‚
    *   **æž¶æž„è®¾è®¡**ï¼šå°†è¯­æ³•åˆ†æž (Lexer) æ”¾å…¥ **Isolate** åŽå°çº¿ç¨‹è¿è¡Œï¼Œé˜²æ­¢å¤§æ®µä»£ç ç²˜è´´æ—¶é˜»å¡ž UI çº¿ç¨‹ã€‚
    *   **æ‰©å±•æ€§**ï¼šå®šä¹‰ `LanguageProfile` æŽ¥å£ï¼Œæ”¯æŒé€šè¿‡ JSON åŠ¨æ€åŠ è½½æ–°çš„è¯­è¨€é«˜äº®è§„åˆ™ã€‚

2.  **ç¡®å®šæ€§åŠ¨ç”»å¼•æ“Ž (Deterministic Animation Engine)**
    *   **æŠ€æœ¯é€‰åž‹**ï¼š`flutter_animate` (å£°æ˜Žå¼åŠ¨ç”») + è‡ªå®šä¹‰ `TickerProvider`ã€‚
    *   **è®¾è®¡æ¨¡å¼**ï¼šé‡‡ç”¨ **Command Pattern (å‘½ä»¤æ¨¡å¼)** ç®¡ç†æ—¶é—´è½´äº‹ä»¶ï¼ˆå¦‚ `TypeCharCommand`, `ScrollCommand`, `HighlightCommand`ï¼‰ã€‚
    *   **ä¼˜åŠ¿**ï¼šå®žçŽ°â€œå¸§çº§ç²¾ç¡®â€æŽ§åˆ¶ï¼Œæ¸²æŸ“å¯¼å‡ºæ—¶å¯è„±ç¦»ç³»ç»Ÿæ—¶é’Ÿï¼Œç¡®ä¿ 60FPS å¯¼å‡ºçš„æ¯ä¸€å¸§éƒ½å®Œç¾Žå¯¹é½ã€‚

3.  **å¼‚æ­¥æ¸²æŸ“æµæ°´çº¿ (Async Rendering Pipeline)**
    *   **æŠ€æœ¯é€‰åž‹**ï¼š`flutter_ffmpeg_kit_min_gpl` (æœ€å°ä½“ç§¯åŒ…ï¼Œçº¦ 20MB) + `image` (Dart åŽŸç”Ÿå›¾åƒå¤„ç†)ã€‚
    *   **å®žçŽ°é€»è¾‘**ï¼š
        1.  åˆ©ç”¨ `RepaintBoundary` æ•èŽ· Canvas å¸§ã€‚
        2.  é€šè¿‡ `ui.Image.toByteData` èŽ·å–åŽŸå§‹åƒç´ ï¼ˆè€—æ—¶æ“ä½œæ”¾ Isolateï¼‰ã€‚
        3.  ä½¿ç”¨ FFmpeg ç®¡é“æ¨¡å¼ (Pipe) å®žæ—¶å†™å…¥è§†é¢‘æµï¼Œé¿å…å†…å­˜æš´æ¶¨ã€‚

4.  **é£Žæ ¼åŒ–ç³»ç»Ÿ (Theming System)**
    *   **è®¾è®¡åŽŸåˆ™**ï¼šåŸºäºŽ **Composition (ç»„åˆ)** è€Œéžç»§æ‰¿ã€‚
    *   **æ•°æ®ç»“æž„**ï¼š`ThemeData` åŒ…å« `BackgroundLayer`, `CodeStyle`, `OverlayEffect` (ç²’å­/å…‰æ•ˆ) ä¸‰ä¸ªç‹¬ç«‹é…ç½®é¡¹ï¼Œå…è®¸ç”¨æˆ·è‡ªç”±æ··æ­ã€‚

### 1.3 é¡µé¢å¸ƒå±€è§„åˆ’

*   **é¦–é¡µ**ï¼šå¤§è¾“å…¥æ¡†ï¼ˆPaste Code Hereï¼‰ï¼Œåº•éƒ¨æ¨ªå‘æ»šåŠ¨é€‰æ‹©â€œé¢„è®¾æ¨¡æ¿â€ã€‚
*   **ç¼–è¾‘é¡µ**ï¼š
    *   ä¸Šéƒ¨ï¼šå®žæ—¶é¢„è§ˆçª—å£ï¼ˆå¯æ‹–æ‹½æ—¶é—´è½´ï¼‰ã€‚
    *   ä¸‹éƒ¨ï¼šé…ç½®é¢æ¿ï¼ˆå­—ä½“å¤§å°ã€æ‰“å­—é€Ÿåº¦ã€èƒŒæ™¯éŸ³ä¹é€‰æ‹©ï¼‰ã€‚
*   **å¯¼å‡ºé¡µ**ï¼šæ¸²æŸ“è¿›åº¦æ¡ï¼Œå¯¼å‡ºå®ŒæˆåŽæä¾›â€œä¸€é”®åˆ†äº«â€åˆ° TikTok/Instagramã€‚

### 1.4 é¡µé¢äº¤äº’æµç¨‹ (Page Interaction Flow)

```mermaid
graph TD
    A[é¦–é¡µ (Home)] -->|ç²˜è´´ä»£ç | B[ç¼–è¾‘é¡µ (Editor)]
    A -->|é€‰æ‹©æ¨¡æ¿| B
    
    subgraph Edit_Process [ç¼–è¾‘ä¸Žé¢„è§ˆ]
    B -->|è°ƒæ•´å‚æ•°| C[å®žæ—¶é¢„è§ˆåŒº]
    C -->|åé¦ˆ| B
    B -->|ç‚¹å‡»ç”Ÿæˆ| D[æ¸²æŸ“å¼•æ“Ž]
    end
    
    D --> E[å¯¼å‡ºé¡µ (Export)]
    E -->|ä¿å­˜/åˆ†äº«| F[ç¤¾äº¤å¹³å°]
    E -->|ä¸æ»¡æ„| B
```

### 1.5 ç›ˆåˆ©æ¨¡å¼ï¼ˆå•†ä¸šåŒ–ï¼‰

*   **Free**ï¼šå¯¼å‡º 720pï¼Œå¸¦æ°´å°ï¼ŒåŸºç¡€æ¨¡æ¿ã€‚
*   **Pro ($9.99/mo)**ï¼š4K å¯¼å‡ºï¼Œæ— æ°´å°ï¼Œè‡ªå®šä¹‰èƒŒæ™¯å›¾ï¼Œä¸“å±žâ€œé»‘å®¢å¸å›½â€ç‰¹æ•ˆã€‚

---

## 2. Off-Grid Mesh Messenger (æ— ç½‘å¯¹è®²æœº)

**å®šä½**ï¼šæœ«æ—¥/æ— ç½‘çŽ¯å¢ƒä¸‹çš„â€œæ•°å­—ç”Ÿå‘½çº¿â€ã€‚
**æ ¸å¿ƒä»·å€¼**ï¼šåœ¨æ²¡æœ‰äº’è”ç½‘ã€æ²¡æœ‰ä¿¡å·çš„æžç«¯çŽ¯å¢ƒä¸‹ï¼Œä¾ç„¶èƒ½è¿žæŽ¥èº«è¾¹çš„äººã€‚

### 2.1 é¡¹ç›®æ¦‚è§ˆ

| ç»´åº¦ | æè¿° |
| :--- | :--- |
| **æŠ€æœ¯æ ˆ** | Flutter + WiFi Direct / BLE (è“ç‰™ä½ŽåŠŸè€—) + Bonsoir (mDNS) |
| **ç›®æ ‡åœºæ™¯** | é£žæœº/æ¸¸è½®ã€åœ°ä¸‹å®¤åŠžå…¬ã€å¤§åž‹éŸ³ä¹èŠ‚ã€ç¾éš¾åº”æ€¥ |
| **æ ¸å¿ƒåè®®** | è‡ªç ” Mesh åè®®æˆ–å¤ç”¨ P2P åº“ï¼Œå®žçŽ°å¤šè·³ä¼ è¾“ï¼ˆA -> B -> Cï¼‰ |

### 2.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (High-Quality Architecture)

1.  **æŠ½è±¡å‘çŽ°å±‚ (Abstract Discovery Layer)**
    *   **è®¾è®¡æ¨¡å¼**ï¼šä½¿ç”¨ **Strategy Pattern (ç­–ç•¥æ¨¡å¼)** å®šä¹‰ `DiscoveryStrategy` æŽ¥å£ã€‚
    *   **å®žçŽ°**ï¼šåˆ†åˆ«å®žçŽ° `BleStrategy` (åŸºäºŽ `flutter_blue_plus` - ç¨³å®šç‰ˆ) å’Œ `WifiStrategy` (åŸºäºŽ `bonsoir` - mDNS)ã€‚
    *   **ä¼˜ç‚¹**ï¼šæ”¯æŒçƒ­åˆ‡æ¢æ‰«ææ¨¡å¼ï¼Œä¸”æœªæ¥æŽ¥å…¥ LoRa æˆ–å£°æ³¢é€šä¿¡æ—¶æ— éœ€ä¿®æ”¹ä¸Šå±‚é€»è¾‘ã€‚

2.  **å¯é ä¼ è¾“åè®® (Reliable Transport Protocol)**
    *   **åºåˆ—åŒ–**ï¼šä½¿ç”¨ **Protobuf** æ›¿ä»£ JSONï¼Œæ•°æ®åŒ…ä½“ç§¯å‡å°‘ 60% ä»¥ä¸Šï¼Œæžé€‚åº”ä½Žå¸¦å®½çŽ¯å¢ƒã€‚
    *   **åˆ†ç‰‡æœºåˆ¶**ï¼šåœ¨åº”ç”¨å±‚å®žçŽ° MTU åˆ†ç‰‡ï¼ˆé’ˆå¯¹ BLE çš„ 512 å­—èŠ‚é™åˆ¶ï¼‰ï¼Œé…åˆæ»‘åŠ¨çª—å£ (Sliding Window) ç®—æ³•ä¿è¯æ•°æ®åŒ…æœ‰åºé‡ç»„ã€‚

3.  **æ··åˆåŠ å¯†å†…æ ¸ (Hybrid Cryptography Core)**
    *   **æŠ€æœ¯é€‰åž‹**ï¼š`cryptography` åº“ (Libsodium å°è£…ï¼Œé«˜æ€§èƒ½)ã€‚
    *   **å®‰å…¨æµç¨‹**ï¼š
        *   **æ¡æ‰‹é˜¶æ®µ**ï¼šX25519 æ¤­åœ†æ›²çº¿äº¤æ¢ä¸´æ—¶å…¬é’¥ã€‚
        *   **é€šä¿¡é˜¶æ®µ**ï¼šä½¿ç”¨ AES-GCM-256 è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œç¡®ä¿æ¶ˆæ¯æœºå¯†æ€§ä¸Žå®Œæ•´æ€§ã€‚

4.  **è½»é‡çº§æ¶ˆæ¯å­˜å‚¨ (Lightweight Storage)**
    *   **æŠ€æœ¯é€‰åž‹**ï¼š`Isar` æ•°æ®åº“ (NoSQL, è¿œå¿«äºŽ SQLite)ã€‚
    *   **ç‰¹æ€§**ï¼šåŽŸç”Ÿæ”¯æŒ Dart å¯¹è±¡ï¼Œå…¨å¼‚æ­¥æ“ä½œï¼Œå®Œç¾Žé€‚é… Flutter çš„ Event Loop æ¨¡åž‹ã€‚

### 2.3 é¡µé¢å¸ƒå±€è§„åˆ’

*   **é›·è¾¾é¡µ (é¦–é¡µ)**ï¼šå…¨å±æ·±è‰²åœ°å›¾/é›·è¾¾æ‰«æåŠ¨ç”»ï¼Œå‘çŽ°è®¾å¤‡åŽç‚¹å‡»å¤´åƒå‘èµ·è¿žæŽ¥ã€‚
*   **èŠå¤©é¡µ**ï¼šç±»ä¼¼å¾®ä¿¡/WhatsAppï¼Œä½†é¡¶éƒ¨çŠ¶æ€æ æ˜¾ç¤ºâ€œè¿žæŽ¥è´¨é‡â€å’Œâ€œä¼ è¾“æ–¹å¼ï¼ˆè“ç‰™/WiFiï¼‰â€ã€‚
*   **å¹¿æ’­å°**ï¼šä¸€ä¸ªå·¨å¤§çš„çº¢è‰²æŒ‰é’®ï¼Œç”¨äºŽå‘é€ SOS æˆ–å…¬å…±å¹¿æ’­ã€‚

### 2.4 é¡µé¢äº¤äº’æµç¨‹ (Page Interaction Flow)

```mermaid
graph TD
    A[é›·è¾¾æ‰«æé¡µ (Radar)] -->|è‡ªåŠ¨æ‰«æ| B((å‘çŽ°è®¾å¤‡))
    B -->|ç‚¹å‡»å¤´åƒ| C{æ˜¯å¦å»ºç«‹è¿žæŽ¥?}
    C -- Yes --> D[æ¡æ‰‹/å¯†é’¥äº¤æ¢]
    D --> E[èŠå¤©ä¼šè¯é¡µ (Chat)]
    
    subgraph Chat_Features [ä¼šè¯åŠŸèƒ½]
    E -->|å‘é€æ¶ˆæ¯| F[æ–‡æœ¬/è¯­éŸ³]
    E -->|å‘é€æ–‡ä»¶| G[å»ºç«‹ TCP ç›´è¿ž]
    E -->|é˜…åŽå³ç„š| H[è®¡æ—¶é”€æ¯]
    end
    
    A -->|ç‚¹å‡»SOS| I[å…¨ç½‘å¹¿æ’­æ¨¡å¼]
    I -->|å¹¿æ’­æ¶ˆæ¯| A
```

### 2.5 é£Žæ ¼ç‰¹è‰²

*   **æˆ˜æœ¯é£Žæ ¼ (Tactical UI)**ï¼šé»‘é»„é…è‰²ï¼Œç¡¬æœ—çº¿æ¡ï¼Œç±»ä¼¼å†›ç”¨ç»ˆç«¯ã€‚
*   **æžç®€äº¤äº’**ï¼šå¤§æŒ‰é’®ï¼Œé«˜å¯¹æ¯”åº¦ï¼Œç¡®ä¿åœ¨æˆ·å¤–å¼ºå…‰ä¸‹ä¹Ÿèƒ½çœ‹æ¸…ã€‚

---

## 3. èžåˆç”Ÿæ€æž„æƒ³ (Optional Integration)

å¦‚æžœè€ƒè™‘å°†è¿™ä¸¤ä¸ªçœ‹ä¼¼ç‹¬ç«‹çš„äº§å“èžåˆåˆ°ä¸€ä¸ªâ€œæžå®¢å·¥å…·ç®± (Geek Toolbox)â€è¶…çº§ App ä¸­ï¼Œå¯ä»¥å…±äº«ä»¥ä¸‹æ¨¡å—ï¼š

### 3.1 å…±äº«æž¶æž„
*   **ç»Ÿä¸€è´¦æˆ·ç³»ç»Ÿ**ï¼šç”¨æˆ·çš„ä¸ªäºº Profileï¼ˆå¤´åƒã€æ˜µç§°ï¼‰åœ¨ç”Ÿæˆè§†é¢‘æ°´å°å’Œ Mesh èŠå¤©æ—¶å…±ç”¨ã€‚
*   **æ–‡ä»¶äº’é€š**ï¼šCode-to-Video ç”Ÿæˆçš„è§†é¢‘ï¼Œå¯ä»¥ç›´æŽ¥é€šè¿‡ Mesh Messenger å‘é€ç»™é™„è¿‘çš„è®¾å¤‡ï¼Œæ— éœ€èµ°å…¬ç½‘ã€‚

### 3.2 èžåˆé¡µé¢å…³ç³»
```mermaid
graph TD
    Root[å·¥å…·ç®±é¦–é¡µ (Dashboard)]
    
    Root -->|åˆ›ä½œ| ModuleA[Code-to-Video]
    Root -->|é€šè®¯| ModuleB[Mesh Messenger]
    
    ModuleA -->|ç”Ÿæˆè§†é¢‘| FilePool[æœ¬åœ°æ–‡ä»¶åº“]
    ModuleB -->|é€‰æ‹©æ–‡ä»¶| FilePool
    
    FilePool -->|Meshä¼ è¾“| ModuleB
```
